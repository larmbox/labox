@use 'sass:math';
@import '../../theme/imports';

$lb-switch-border-radius: 64px !default;
$lb-switch-focus-shadow-size: $lb-focus-shadow-size !default;
$lb-switch-text-color: $lb-text-color !default;
$lb-switch-border-color: $lb-border-color !default;
$lb-switch-border-color-disabled: $lb-border-color !default;
$lb-switch-border-width: $lb-border-width !default;

$lb-switch-size: 1.5rem !default;

$lb-switch-size-sm: 1.25rem !default;

$lb-switch-size-lg: 1.75rem !default;

@mixin switch-size($suffix, $size) {
  &.#{c('LSwitch')}-#{$suffix} {
    .#{c('LSwitch')}-inner .#{c('LSwitch')}-descriptors {
      min-height: $size;
    }
    .#{c('LSwitch')}-box {
      width: $size * 2;
      height: $size;
      padding: 0.1rem 0.15rem;
      .#{c('LSwitch')}-box2 {
        width: $size - 0.25rem;
        height: $size - 0.25rem;
      }
    }
    input {
      width: $size * 2;
      height: $size;

      &:active:not(:disabled) {
        + .#{c('LSwitch')}-box {
          .#{c('LSwitch')}-box2 {
            width: $size;
          }
        }
      }
    }
  }
}

@mixin switch-color($color, $theme: $lb-default-theme) {
  .#{c('LSwitch')}-box2 {
    background-color: color($color, 8, $theme);
    svg {
      fill: contrast-tone(color2($color, 8, $theme));
    }
  }

  input {
    &:checked {
      + .#{c('LSwitch')}-box {
        background-color: color($color, 1, $theme);
        .#{c('LSwitch')}-box2 {
          left: 100%;
          transform: translateX(-100%);
        }
      }
    }

    &:focus {
      + .#{c('LSwitch')}-box {
        border-color: color($color, 8, $theme);
        box-shadow: 0 0 0 $lb-switch-focus-shadow-size
          color($color, 'T25', $theme);
      }
    }

    &:disabled:checked {
      + .#{c('LSwitch')}-box {
        border-color: color($color, 6, $theme);
        background-color: color($color, 6, $theme);
      }
    }

    &:disabled:not(:checked) {
      + .#{c('LSwitch')}-box {
        border-color: color($color, 3, $theme);
      }
    }
  }
}

.#{c('LSwitch')} {
  display: inline-flex;
  position: relative;
  margin-bottom: 1rem;
  align-items: center;

  &.#{c('LSwitch')}-block {
    width: 100%;
    display: flex;
  }

  @mixin switch-variants($variant, $theme: $lb-default-theme) {
    &.#{c(LSwitch)}-#{$variant} {
      @include switch-color($variant, $theme);
    }
  }

  @each $name, $variant-map in lb-themes() {
    @if css-vars() {
      @include switch-variants($name);
    } @else {
      &.#{$lb-theme-prefix}#{$name} {
        @each $variant, $_ in $variant-map {
          @include switch-variants($variant, $name);
        }
      }
    }
  }

  .#{c('LSwitch')}-box {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    border: $lb-switch-border-width solid $lb-switch-border-color;
    border-radius: $lb-switch-border-radius;
    box-shadow: 0 0 0 $lb-switch-focus-shadow-size transparent;
    transition: border-color $lb-animation-time ease-in-out,
      background-color $lb-animation-time ease-in-out,
      box-shadow $lb-animation-time ease-in-out;

    .#{c('LSwitch')}-box2 {
      left: 0;
      position: relative;
      pointer-events: none;
      transition: left $lb-animation-time ease-in-out,
        transform $lb-animation-time ease-in-out,
        width $lb-animation-time ease-in-out;
      border-radius: $lb-switch-border-radius;
      display: flex;
      align-items: center;
      justify-content: center;

      svg {
        position: absolute;
        padding: 0.2rem;
        width: 100%;
        height: 100%;
      }
      svg:first-of-type {
        opacity: 0;
      }
      svg:last-of-type {
        opacity: 1;
      }
    }
  }

  .#{c('LSwitch')}-inner {
    display: flex;
    flex: 1;
    .#{c('LSwitch')}-descriptors {
      display: inline-flex;
      flex-direction: column;
      justify-content: center;
      margin-left: $lb-spacing-xs * 2;
      .#{c('LSwitch')}-label {
        margin-bottom: 0;
        display: block;
      }
      .#{c('LSwitch')}-feedback {
        margin-top: $lb-spacing-xs;
        display: block;
      }
      .#{c('LSwitch')}-description {
        margin-top: $lb-spacing-xs;
        margin-bottom: 0;
        display: block;
      }
    }
  }

  input {
    position: absolute;
    left: 0;
    top: 0;
    margin: 0;
    opacity: 0;
    z-index: 1;

    &:checked {
      + .#{c('LSwitch')}-box {
        .#{c('LSwitch')}-box2 {
          svg:first-of-type {
            opacity: 1;
          }
          svg:last-of-type {
            opacity: 0;
          }
        }
      }
    }
  }

  &.form-feedback-error {
    @include switch-color('error');

    .#{c('LSwitch')}-box {
      border-color: color('error', 8);
    }
  }

  &.form-feedback-success {
    @include switch-color('success');

    .#{c('LSwitch')}-box {
      border-color: color('error', 8);
    }
  }

  @include switch-size('md', $lb-switch-size);
  @include switch-size('sm', $lb-switch-size-sm);
  @include switch-size('lg', $lb-switch-size-lg);
}
